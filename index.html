<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>××¢×¨×›×ª Harvest â€“ ×”×¤×˜×œ ×©×œ ×¢×•×¤×¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Mermaid for data-flow diagram -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'neutral',
            flowchart: { curve: 'basis' }
        });
    </script>
    
    <style>
        :root {
            --primary: #002366; /* Royal Blue */
            --accent:  #D4AF37; /* Gold */
            --light:   #F3F4F6;
            --white:   #ffffff;
            --dark:    #1F2937;
            --muted:   #6B7280;
            --code-bg: #1e1e1e;
            --success: #10B981;
            --warning-bg: #FFF7ED;
            --warning-border: #FDBA74;
            --badge-bg: #E5E7EB;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Header */
        header {
            background: var(--primary);
            color: var(--white);
            padding: 40px 20px;
            border-bottom: 5px solid var(--accent);
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        header p {
            margin: 10px 0 0;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: -30px auto 40px;
            padding: 0 20px;
            position: relative;
            z-index: 10;
        }

        /* Navigation */
        .nav {
            background: var(--white);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .nav a {
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--primary);
            background: #EFF6FF;
            transition: all 0.2s;
        }

        .nav a:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Content Blocks */
        section {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        h2 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 10px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h3 {
            margin-top: 25px;
            font-size: 1.1rem;
            color: #374151;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: var(--badge-bg);
            color: #111827;
        }

        code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            font-size: 0.85rem;
            background: #EEF2FF;
            padding: 1px 5px;
            border-radius: 4px;
        }

        /* Platforms Grid */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .platform {
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            padding: 20px;
            background: #FAFAFA;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
        }

        .platform:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .platform strong {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 6px;
            color: var(--primary);
        }

        .platform div {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 14px;
            min-height: 40px;
        }

        .link-btn {
            display: inline-block;
            width: 100%;
            text-align: center;
            padding: 8px 0;
            border-radius: 6px;
            background: var(--white);
            border: 1px solid var(--primary);
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .link-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* Flowchart Container */
        .mermaid-container {
            background: #F8FAFC;
            padding: 20px;
            border-radius: 12px;
            border: 1px dashed #CBD5E1;
            text-align: center;
            margin: 20px 0;
        }

        /* Callouts */
        .callout {
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-size: 0.95rem;
        }

        .callout.warning {
            background: var(--warning-bg);
            border-right: 4px solid var(--warning-border);
            color: #9A3412;
        }

        .callout.info {
            background: #EFF6FF;
            border-right: 4px solid var(--primary);
            color: #1E40AF;
        }

        /* Code Blocks */
        .code-wrapper {
            position: relative;
            background: var(--code-bg);
            border-radius: 8px;
            margin-top: 10px;
            overflow: hidden;
        }

        pre {
            margin: 0;
            padding: 20px;
            overflow-x: auto;
            color: #E5E7EB;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            font-size: 0.85rem;
            direction: ltr;
            text-align: left;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Email Preview Card */
        .email-preview {
            background: #F3F4F6;
            padding: 20px;
            border-radius: 12px;
            font-family: Arial, sans-serif;
            border: 1px solid #E5E7EB;
            max-width: 600px;
            margin: 20px auto;
        }

        .email-header {
            border-bottom: 1px solid #D1D5DB;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .email-meta {
            font-size: 0.85rem;
            color: #6B7280;
            margin-bottom: 4px;
        }

        .email-body {
            font-size: 0.95rem;
            color: #111827;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .email-highlight {
            background: #FEF3C7;
            padding: 2px 4px;
            border-radius: 2px;
        }

        /* Details/Summary */
        details {
            background: #FAFAFA;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        summary {
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 600;
            list-style: none;
            position: relative;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::after {
            content: "+";
            position: absolute;
            left: 16px;
            font-weight: bold;
            color: var(--primary);
        }

        details[open] summary::after {
            content: "-";
        }

        .details-content {
            padding: 16px;
            border-top: 1px solid #E5E7EB;
            background: #fff;
            border-radius: 0 0 8px 8px;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            font-size: 0.9rem;
        }

        .top-link {
            display: block;
            text-align: left;
            margin-top: 20px;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>

<header>
    <h1>Harvest â€“ ××¢×¨×›×ª ××¢×§×‘ ×§×˜×™×£</h1>
    <p>×”×¤×˜×œ ×©×œ ×¢×•×¤×¨ | ×ª×™×¢×•×“ ×˜×›× ×™, ××•×˜×•××¦×™×•×ª ×•× ×”×œ×™ ×¢×‘×•×“×”</p>
</header>

<div class="container">

    <nav class="nav">
        <a href="#overview">××‘×˜ ×¢×œ</a>
        <a href="#flow">×–×¨×™××ª × ×ª×•× ×™×</a>
        <a href="#components">×¨×›×™×‘×™ ×”××¢×¨×›×ª</a>
        <a href="#performance">×ª×•×‘× ×•×ª ×•-KPI</a>
        <a href="#automation">×¡×§×¨×™×¤×˜×™×</a>
        <a href="#email-preview">×“×•×’××ª ××™×™×œ</a>
        <a href="#maintenance">×ª×—×–×•×§×” ×•×˜×¨×™×’×¨×™×</a>
    </nav>

    <!-- 1. Overview -->
    <section id="overview">
        <h2>1. ×’×™×©×” ××”×™×¨×” ×œ×¨×›×™×‘×™×</h2>
        <div class="platform-grid">
            <div class="platform">
                <strong>ğŸ“² ×§×œ×˜ ×‘×©×˜×— (Fillout) <span class="badge">×§×œ×˜</span></strong>
                <div>×˜×•×¤×¡ ×“×™×’×™×˜×œ×™ ×œ××™×œ×•×™ ×¢"×™ ×¢×•×‘×“×™× ×‘×¡×™×•× ×™×•× ×§×˜×™×£.</div>
                <a class="link-btn" href="https://forms.fillout.com/t/f1b1uSZiHius" target="_blank">×¤×ª×— ×˜×•×¤×¡</a>
            </div>
            <div class="platform">
                <strong>ğŸ“‚ ×××’×¨ ×ª×©×•×‘×•×ª ×’×•×œ××™ <span class="badge">××§×•×¨ × ×ª×•× ×™×</span></strong>
                <div>×’×™×œ×™×•×Ÿ ××œ×™×• ××ª× ×§×–×•×ª ×›×œ ×”×ª×©×•×‘×•×ª ××”×˜×•×¤×¡ (Backup + ××§×•×¨ ×œ-IMPORTRANGE).</div>
                <a class="link-btn" href="https://docs.google.com/spreadsheets/d/1Zi0tJO4om1sPwmA8dTslF1knk7Fi_iHBJ97VBhpZAVk/edit?usp=sharing" target="_blank">×¤×ª×— ×’×™×œ×™×•×Ÿ ×ª×©×•×‘×•×ª</a>
            </div>
            <div class="platform">
                <strong>ğŸ“Š ×—×•×‘×¨×ª ×¨××©×™×ª ×•× ×™×”×•×œ <span class="badge">×¢×™×‘×•×“ + ×“×©×‘×•×¨×“</span></strong>
                <div>×”××•×— ×©×œ ×”××¢×¨×›×ª: ×¢×™×‘×•×“ × ×ª×•× ×™×, KPI, ×’×¨×¤×™× ×•×¡×§×¨×™×¤×˜×™×.</div>
                <a class="link-btn" href="https://docs.google.com/spreadsheets/d/1JS5ZPejDNjVlq-Qk9R0Cncb19vuJ18Gsf4A99WSscSE/edit?gid=1085857775#gid=1085857775" target="_blank">×¤×ª×— ×—×•×‘×¨×ª ×¨××©×™×ª</a>
            </div>
        </div>
    </section>

    <!-- 2. Flow -->
    <section id="flow">
        <h2>2. ×ª×¨×©×™× ×–×¨×™××ª × ×ª×•× ×™×</h2>
        <p>×”×ª×”×œ×™×š ××•×˜×•××˜×™ ××¨×’×¢ ×©×œ×™×—×ª ×”×˜×•×¤×¡ ×•×¢×“ ×§×‘×œ×ª ×”××™×™×œ ×”×©×‘×•×¢×™ ×œ×× ×”×œ×™×.</p>
        
        <div class="mermaid-container">
            <div class="mermaid">
                flowchart TD
                    A[×¢×•×‘×“ ×‘×©×˜×—] -->|××™×œ×•×™ ×‘×˜×œ×¤×•×Ÿ| B(×˜×•×¤×¡ Fillout)
                    B -->|×©××™×¨×” ××•×˜×•××˜×™×ª| C[×’×™×œ×™×•×Ÿ ×ª×©×•×‘×•×ª ×—×™×¦×•× ×™<br/>Raw Data]
                    C -.->|IMPORTRANGE| D[×—×•×‘×¨×ª ×¨××©×™×ª<br/>×’×™×œ×™×•×Ÿ <code>Raw_Responses</code>]
                    D -->|×˜×¨×™×’×¨ ×©×™× ×•×™ × ×ª×•× ×™×\nrebuildHarvestData| E[×˜×‘×œ×ª × ×ª×•× ×™× ××¢×•×‘×“×ª<br/>×’×™×œ×™×•×Ÿ <code>Harvest_Data</code>]
                    E -->|× ×•×¡×—××•×ª| F[×’×™×œ×™×•× ×•×ª × ×™×ª×•×—<br/>Harvest_KPI / Greenhouse_Performance]
                    F -->|×˜×¨×™×’×¨ ×©×‘×•×¢×™\nsendWeeklyHarvestEmail| G[×¡×§×¨×™×¤×˜ ××™×™×œ]
                    G -->|×©×œ×™×—×”| H[××™×™×œ ×¡×™×›×•× ×œ×× ×”×œ×™×]
            </div>
        </div>

        <details>
            <summary>×¤×™×¨×•×˜ ×§×¦×¨ ×œ×¤×™ ×©×œ×‘×™×</summary>
            <div class="details-content">
                <ol>
                    <li>×”×¢×•×‘×“ ×××œ× ×˜×•×¤×¡ Fillout ××”×˜×œ×¤×•×Ÿ.</li>
                    <li>Fillout ×¨×•×©× ×©×•×¨×” ×—×“×©×” ×‘×’×™×œ×™×•×Ÿ ×ª×©×•×‘×•×ª ×—×™×¦×•× ×™ (Google Sheets).</li>
                    <li>×‘×’×™×œ×™×•×Ÿ ×”×¨××©×™, <code>Raw_Responses</code> ××•×©×š ××ª ×”× ×ª×•× ×™× ×‘×××¦×¢×•×ª <code>IMPORTRANGE</code>.</li>
                    <li>×˜×¨×™×’×¨ ×©×™× ×•×™ × ×ª×•× ×™× ××¤×¢×™×œ ××ª <code>rebuildHarvestData</code>, ×©×× ×§×” ×•×‘×•× ×” ××—×“×© ××ª <code>Harvest_Data</code>.</li>
                    <li>×’×™×œ×™×•× ×•×ª <code>Harvest_KPI</code> ×•-<code>Greenhouse_Performance</code> ××‘×¦×¢×™× ×—×™×©×•×‘×™× ××¢×œ <code>Harvest_Data</code>.</li>
                    <li>×˜×¨×™×’×¨ ×©×‘×•×¢×™ ××¤×¢×™×œ ××ª <code>sendWeeklyHarvestEmail</code>, ×©××¡×›× ×©×‘×•×¢ ×•×©×•×œ×— ××™×™×œ ×œ×× ×”×œ×™×.</li>
                </ol>
            </div>
        </details>
    </section>

    <!-- 3. Components -->
    <section id="components">
        <h2>3. ××‘× ×” ×”×—×•×‘×¨×ª ×”×¨××©×™×ª</h2>
        
        <div class="callout warning">
            <strong>âš ï¸ × ×§×•×“×” ×§×¨×™×˜×™×ª ×œ×ª×—×–×•×§×”:</strong><br>
            ×”× ×ª×•× ×™× × ×›× ×¡×™× ×œ×’×™×œ×™×•×Ÿ <code>Raw_Responses</code> ×‘×××¦×¢×•×ª × ×•×¡×—×ª <code>IMPORTRANGE</code>.
            ×× ××—×œ×™×¤×™× ××ª "×’×™×œ×™×•×Ÿ ×”×ª×©×•×‘×•×ª ×”×—×™×¦×•× ×™", ×™×© ×œ×¢×“×›×Ÿ ××ª ×”-URL ×‘×ª×•×š ×”× ×•×¡×—×” (×‘×“"×› ×‘×ª× A1) ×•×œ××©×¨ ×’×™×©×” ××—×“×©.
        </div>

        <details open>
            <summary>×¤×™×¨×•×˜ ×”×’×™×œ×™×•× ×•×ª</summary>
            <div class="details-content">
                <ul>
                    <li><strong><code>Raw_Responses</code> <span class="badge">×§×¨×™××” ×‘×œ×‘×“</span></strong> â€“ ××¢×ª×™×§ ××ª ×”××™×“×¢ ×”×’×•×œ××™ ×›×¤×™ ×©×”×•× ××§×•×‘×¥ ×”×ª×©×•×‘×•×ª ×”×—×™×¦×•× ×™.</li>
                    <li><strong><code>Harvest_Data</code> <span class="badge">× ×‘× ×” ××•×˜×•××˜×™×ª</span></strong> â€“ ×ª×•×¦×¨ ×©×œ ×”×¡×§×¨×™×¤×˜; ×˜×‘×œ×” "×©×˜×•×—×”" ×•××¡×•×“×¨×ª ×”×××¤×©×¨×ª Pivot, ×¡×™× ×•× ×™× ×•×’×¨×¤×™×.</li>
                    <li><strong><code>Harvest_KPI</code></strong> â€“ ×—×™×©×•×‘×™× ×™×•××™×™× ×œ×¤×™ ×ª××¨×™×š Ã— ×—×××” Ã— ×–×Ÿ (×¡×š ×§"×’, ××—×•×– ×¡×•×’ ×‘', ×™×—×™×“×•×ª × ×•×¡×¤×•×ª).</li>
                    <li><strong><code>Greenhouse_Performance</code></strong> â€“ ×“×©×‘×•×¨×“ × ×™×”×•×œ×™: ×¡×›×•××™× ×©×‘×•×¢×™×™×/×—×•×“×©×™×™×, ×”×©×•×•××” ×‘×™×Ÿ ×—×××•×ª ×•××’××•×ª.</li>
                    <li><strong><code>Config_Greenhouses</code> <span class="badge">×§×•× ×¤×™×’×•×¨×¦×™×”</span></strong> â€“ ×”×’×“×¨×•×ª ×§×‘×•×¢×•×ª (×©××•×ª ×—×××•×ª, ×©×˜×—, ×–× ×™×, ××˜×¨ ×¨×¥ ×•×›×•').</li>
                </ul>
            </div>
        </details>
    </section>

    <!-- 4. Performance -->
    <section id="performance">
        <h2>4. ×ª×•×‘× ×•×ª ×¢×¡×§×™×•×ª: Greenhouse_Performance</h2>
        <p>×’×™×œ×™×•×Ÿ ×–×” ×”×•× ×”"×“×©×‘×•×¨×“" ×”× ×™×”×•×œ×™ â€“ less ×¢×œ × ×ª×•×Ÿ ×‘×•×“×“, more ×¢×œ ×ª××•× ×” ×›×•×œ×œ×ª ×•×”×ª× ×”×’×•×ª ×œ××•×¨×š ×–××Ÿ.</p>
        
        <div class="platform-grid">
            <div class="platform" style="background: #F0FDF4; border-color: #BBF7D0;">
                <strong>ğŸš¨ ×–×™×”×•×™ ××™×›×•×ª (×¡×•×’ ×‘')</strong>
                <div>×”×× ×—×××” ××¡×•×™××ª ×—×•×¨×’×ª ×‘××•×¤×Ÿ ×§×‘×•×¢ ×‘××—×•×– ×¡×•×’ ×‘'? ×–×” ×™×›×•×œ ×œ×”×¦×‘×™×¢ ×¢×œ ××–×™×§×™×, ×‘×¢×™×•×ª ×”×©×§×™×” ××• ×§×˜×™×£ ×¨×©×œ× ×™.</div>
            </div>
            <div class="platform" style="background: #EFF6FF; border-color: #BFDBFE;">
                <strong>âš–ï¸ ×”×©×•×•××ª ×ª×¤×•×§×”</strong>
                <div>×”×©×•×•××” ×‘×™×Ÿ ×—×××•×ª ×‘×¢×œ×•×ª ×××¤×™×™× ×™× ×“×•××™×. ×”×× ×—×××” 3 ×× ×™×‘×” ×¤×—×•×ª ××—×××” 4 ×‘××•×ª×• ×©×‘×•×¢?</div>
            </div>
            <div class="platform" style="background: #FEFCE8; border-color: #FEF08A;">
                <strong>ğŸ“… ××’××•×ª (30 ×™×•×)</strong>
                <div>×‘×“×™×§×ª ××’××ª ×¢×œ×™×™×”/×™×¨×™×“×” ×‘×›××•×™×•×ª ×œ××•×¨×š 30 ×™×•×. ×××¤×©×¨ ×”×™×¢×¨×›×•×ª ×œ×›×•×— ××“×, ×©×™×•×•×§ ×•×ª×›× ×•×Ÿ ×’×™×“×•×œ.</div>
            </div>
        </div>
    </section>

    <!-- 5. Automation / Scripts -->
    <section id="automation">
        <h2>5. ×¡×§×¨×™×¤×˜×™× ×•××•×˜×•××¦×™×” (Apps Script)</h2>
        <p>×©× ×™ ×”×¡×§×¨×™×¤×˜×™× ×”×‘××™× ××”×•×•×™× ××ª "×”×œ×•×’×™×§×” ×”×¢×¡×§×™×ª" ×©×œ ×”××¢×¨×›×ª: ×”××—×“ ××¢×‘×“ ×•×× ×§×” ××ª ×”× ×ª×•× ×™×, ×”×©× ×™ ×©×•×œ×— ×¡×™×›×•× ×©×‘×•×¢×™ ×‘××™×™×œ.</p>

        <h3>×. ×¢×™×‘×•×“ × ×ª×•× ×™× (rebuildHarvestData)</h3>
        <p>×¤×•× ×§×¦×™×” ×–×• ×”×•×¤×›×ª ×˜×§×¡×˜ ×’×•×œ××™ ××”×˜×•×¤×¡ ×œ×˜×‘×œ×” ××¡×•×“×¨×ª ×¢× ×©×•×¨×•×ª × ×¤×¨×“×•×ª ×œ×›×œ ×—×××”/×–×Ÿ:</p>
        <ul>
            <li>×§×•×¨××ª ××ª ×›×œ ×”× ×ª×•× ×™× ××’×™×œ×™×•×Ÿ <code>Raw_Responses</code>.</li>
            <li>×××ª×¨×ª ×¢××•×“×•×ª ×œ×¤×™ ×›×•×ª×¨×•×ª ×‘×¢×‘×¨×™×ª (×ª××¨×™×š, ×©× ×××œ× ×”×“×•×—, ×”×¢×¨×•×ª, ×˜×‘×œ×ª ×§×˜×™×£).</li>
            <li>××¤×¦×œ×ª ××ª ×”×˜×§×¡×˜ ×”×¨×‘-×©×•×¨×” ×œ×¢××•×“×•×ª: ×—×××”, ×–×Ÿ, ×›××•×ª ×¡×•×’ ×, ×›××•×ª ×¡×•×’ ×‘.</li>
            <li>×›×•×ª×‘×ª ×œ-<code>Harvest_Data</code> ×¢× ××–×”×™ <code>SubmissionID</code> ×•-<code>LineIndex</code> ×œ×›×œ ×©×•×¨×”.</li>
        </ul>

        <div class="callout warning">
            <strong>××•×§×© × ×¤×•×¥:</strong> ×”×¤×•× ×§×¦×™×” ××ª×‘×¡×¡×ª ×¢×œ ×©××•×ª ×›×•×ª×¨×•×ª ×”×¢××•×“×•×ª ×‘×“×™×•×§ ×›×¤×™ ×©×”×Ÿ ××•×¤×™×¢×•×ª ×‘-<code>Raw_Responses</code>.
            ×©×™× ×•×™ ×˜×§×¡×˜ ×‘×©×“×” ×‘×¤×œ×˜×¤×•×¨××ª Fillout ×™×©× ×” ××ª ×”×›×•×ª×¨×ª ×•×¢×œ×•×œ ×œ×’×¨×•× ×œ×©×’×™××”
            <code>"Column not found: ..."</code>. ×‘××§×¨×” ×›×–×” ×™×© ×œ×¢×“×›×Ÿ ××ª ×”××—×¨×•×–×•×ª ×‘×§×•×“ ××• ×œ×”×©×™×‘ ××ª ×”×›×•×ª×¨×ª ×”××§×•×¨×™×ª.
        </div>

        <div class="code-wrapper">
            <button class="copy-btn" onclick="copyToClipboard('code1')">×”×¢×ª×§ ×§×•×“</button>
<pre id="code1">
function rebuildHarvestData() {
  const ss = SpreadsheetApp.getActive();
  const RAW_SHEET_NAME = 'Raw_Responses';
  const OUT_SHEET_NAME = 'Harvest_Data';

  const rawSheet = ss.getSheetByName(RAW_SHEET_NAME);
  const outSheet = ss.getSheetByName(OUT_SHEET_NAME);

  if (!rawSheet || !outSheet) {
    throw new Error('Missing sheets: Raw_Responses or Harvest_Data');
  }

  const rawData = rawSheet.getDataRange().getValues();
  if (rawData.length &lt; 2) return; // No data

  const headers = rawData[0];

  // Helper to find column index by name
  function colIndex(name) {
    const idx = headers.indexOf(name);
    if (idx === -1) throw new Error('Column not found: ' + name);
    return idx;
  }

  // Map columns based on Fillout headers
  const dateCol  = colIndex('×ª××¨×™×š ×”×§×˜×™×£');
  const nameCol  = colIndex('×©× ×××œ× ×”×“×•×—');
  const notesCol = colIndex('×”×¢×¨×•×ª ×œ×™×•× ×”×§×˜×™×£ (××–×’ ××•×•×™×¨, ×‘×¢×™×•×ª, ×—×××•×ª ×©×œ× × ×§×˜×¤×• ×•×›×•\')');
  const tableCol = colIndex('×¨×™×©×•× ×§×˜×™×£ ×œ×¤×™ ×—×××” ×•×–×Ÿ');

  // Define Output Headers
  const outHeaders = [
    '×ª××¨×™×š ×”×§×˜×™×£',
    '×—×××”',
    '×–×Ÿ',
    '×›××•×ª ×¡×•×’ × (× ×¡×¤×§×™×)',
    '×›××•×ª ×¡×•×’ ×‘ (×§"×’)',
    '×©× ×××œ× ×”×“×•×—',
    '×”×¢×¨×•×ª ×œ×™×•× ×”×§×˜×™×£',
    'SubmissionID',
    'LineIndex'
  ];

  // Clear old data (keep headers if row 1 exists)
  const lastOutRow = outSheet.getLastRow();
  if (lastOutRow &gt; 1) {
    outSheet.getRange(2, 1, lastOutRow - 1, outHeaders.length).clearContent();
  }
  outSheet.getRange(1, 1, 1, outHeaders.length).setValues([outHeaders]);

  const outRows = [];

  // Iterate raw rows
  for (let i = 1; i &lt; rawData.length; i++) {
    const row = rawData[i];
    const date = row[dateCol];
    const filler = row[nameCol];
    const notes = row[notesCol];
    const tableStr = row[tableCol];

    if (!tableStr) continue;

    const lines = tableStr.toString().split('\n');
    let lineIndex = 0;

    // Skip internal header of the text block usually
    for (let j = 1; j &lt; lines.length; j++) {
      let line = lines[j].trim();
      if (!line) continue;

      const parts = line.split(',');
      if (parts.length &lt; 4) continue;

      outRows.push([
        date,
        parts[0].trim(),       // Greenhouse
        parts[1].trim(),       // Variety
        toNumberSafe(parts[2]),// Grade A
        toNumberSafe(parts[3]),// Grade B
        filler,
        notes,
        i + 1,                 // Simple ID: original row + 1 (1-based)
        ++lineIndex
      ]);
    }
  }

  if (outRows.length &gt; 0) {
    outSheet.getRange(2, 1, outRows.length, outHeaders.length).setValues(outRows);
  }
}

// Helper for safe numeric conversion
function toNumberSafe(val) {
  if (typeof val === 'number') return val;
  if (!val) return 0;
  const num = Number(val.toString().replace(/[^\d.\-]/g, ''));
  return isNaN(num) ? 0 : num;
}
</pre>
        </div>

        <h3>×‘. ×©×œ×™×—×ª ×“×•×— ×©×‘×•×¢×™ (sendWeeklyHarvestEmail)</h3>
        <p>×¤×•× ×§×¦×™×” ×–×• ×¨×¦×” ×‘×××¦×¢×•×ª ×˜×¨×™×’×¨ ×–××Ÿ (Time-driven) ×¤×¢× ×‘×©×‘×•×¢, ××¡×›××ª ××ª × ×ª×•× ×™ ×”-Harvest ×œ×©×‘×•×¢ ×”××—×¨×•×Ÿ ×•×©×•×œ×—×ª ××™×™×œ × ×™×”×•×œ×™.</p>
        <ul>
            <li>××’×“×™×¨×” ×˜×•×•×— ×ª××¨×™×›×™× â€“ 7 ×™××™× ××—×¨×•× ×™× ×›×•×œ×œ ×”×™×•×.</li>
            <li>×§×•×¨××ª ××ª <code>Harvest_KPI</code>, ××¡×›××ª ×œ×¤×™ ×—×××” ×•×–×Ÿ.</li>
            <li>××›×™× ×” ×¡×™×›×•× ×›×•×œ×œ + ×¤×™×¨×•×˜ ×œ×¤×™ ×—×××”.</li>
            <li>×©×•×œ×—×ª ××™×™×œ ×œ×›×ª×•×‘×•×ª ×©×”×•×’×“×¨×• ×‘×§×•×“.</li>
        </ul>

        <div class="callout info">
            <strong>×”×¢×¨×”:</strong> ×”×§×•×“ ×”×‘× ×”×•× ×ª×‘× ×™×ª ×‘×¡×™×¡×™×ª. ×‘××¢×¨×›×ª ×‘×¤×•×¢×œ ×¨×¦×•×™ ×œ×”×ª××™× ××ª ××™×¤×•×™ ×”×¢××•×“×•×ª ×‘-<code>Harvest_KPI</code>
            ×•××ª × ×•×¡×— ×”××™×™×œ ×œ×¦×¨×›×™× ×¢×¡×§×™×™×. ×—×©×•×‘ ×œ×¢×“×›×Ÿ ××ª ×¨×©×™××ª ×”× ××¢× ×™× ×œ×¤× ×™ ×”×¤×¢×œ×” ×‘××¢×¨×›×ª ×—×™×”.
        </div>

        <div class="code-wrapper">
            <button class="copy-btn" onclick="copyToClipboard('code2')">×”×¢×ª×§ ×§×•×“</button>
<pre id="code2">
function sendWeeklyHarvestEmail() {
  const ss = SpreadsheetApp.getActive();
  const tz = ss.getSpreadsheetTimeZone() || Session.getScriptTimeZone();

  // Define Time Window (Last 7 days, including today)
  const today = new Date();
  const endDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  const startDate = new Date(endDate);
  startDate.setDate(startDate.getDate() - 6);

  const kpiSheet = ss.getSheetByName('Harvest_KPI');
  if (!kpiSheet) {
    Logger.log('Missing sheet Harvest_KPI');
    return;
  }

  const data = kpiSheet.getDataRange().getValues();
  if (data.length &lt; 2) {
    Logger.log('No KPI data');
    return;
  }

  const headers = data[0];

  // Example column mapping â€“ MUST be adapted to the actual sheet structure
  const dateColIndex     = headers.indexOf('×ª××¨×™×š');
  const greenhouseColIdx = headers.indexOf('×—×××”');
  const totalKgColIdx    = headers.indexOf('×¡×”"×› ×§"×’');
  const gradeBKgColIdx   = headers.indexOf('×§"×’ ×¡×•×’ ×‘\'');

  if (dateColIndex === -1 || greenhouseColIdx === -1 ||
      totalKgColIdx === -1 || gradeBKgColIdx === -1) {
    throw new Error('One or more required columns not found in Harvest_KPI');
  }

  // Aggregate per greenhouse for the last 7 days
  const byGreenhouse = {};
  let totalKgAll = 0;
  let totalGradeBAll = 0;

  for (let i = 1; i &lt; data.length; i++) {
    const row = data[i];
    const dateVal = row[dateColIndex];
    const ghName  = row[greenhouseColIdx];
    const totalKg = Number(row[totalKgColIdx]) || 0;
    const gradeB  = Number(row[gradeBKgColIdx]) || 0;

    if (!ghName || !(dateVal instanceof Date)) continue;

    const d = new Date(dateVal.getFullYear(), dateVal.getMonth(), dateVal.getDate());
    if (d &lt; startDate || d &gt; endDate) continue;

    if (!byGreenhouse[ghName]) {
      byGreenhouse[ghName] = { totalKg: 0, gradeB: 0 };
    }

    byGreenhouse[ghName].totalKg += totalKg;
    byGreenhouse[ghName].gradeB += gradeB;

    totalKgAll += totalKg;
    totalGradeBAll += gradeB;
  }

  if (totalKgAll === 0) {
    Logger.log('No harvest in the past 7 days, skipping email');
    return;
  }

  const totalGradeBPercent =
    totalKgAll &gt; 0 ? (totalGradeBAll / totalKgAll) * 100 : 0;

  // Build email body
  let body = '';
  body += '×¡×™×›×•× ×§×˜×™×£ ×©×‘×•×¢×™ â€“ ' +
          Utilities.formatDate(startDate, tz, 'dd/MM/yyyy') +
          ' ×¢×“ ' +
          Utilities.formatDate(endDate, tz, 'dd/MM/yyyy') + '\n\n';

  body += '×¡×”"×› ×¤×˜×œ ×‘×›×œ ×”×—×××•×ª ×”×©×‘×•×¢: ' +
          totalKgAll.toFixed(1) + ' ×§"×’\n';
  body += '(××ª×•×›× ×¡×•×’ ×‘\': ' +
          totalGradeBAll.toFixed(1) + ' ×§"×’, ' +
          totalGradeBPercent.toFixed(1) + '%)\n\n';
  body += '-----------------------\n';
  body += '×¤×™×¨×•×˜ ×œ×¤×™ ×—×××”:\n';

  Object.keys(byGreenhouse).forEach(function(gh) {
    const ghData = byGreenhouse[gh];
    const ghPercent =
      ghData.totalKg &gt; 0 ? (ghData.gradeB / ghData.totalKg) * 100 : 0;

    body += gh + ': ' +
            ghData.totalKg.toFixed(1) + ' ×§"×’ ×¡×”"×›, ' +
            ghData.gradeB.toFixed(1) + ' ×§"×’ ×¡×•×’ ×‘\' (' +
            ghPercent.toFixed(1) + '%)\n';
  });

  body += '\n×œ×¦×¤×™×™×” ×‘× ×ª×•× ×™× ×”××œ××™×:\n';
  body += ss.getUrl() + '\n';

  // TODO: Update recipients list before using in production
  const recipients = 'manager1@example.com,manager2@example.com';
  const subject = '×¡×™×›×•× ×§×˜×™×£ ×©×‘×•×¢×™ â€“ ' +
    Utilities.formatDate(startDate, tz, 'dd/MM') +
    ' ×¢×“ ' +
    Utilities.formatDate(endDate, tz, 'dd/MM');

  MailApp.sendEmail({
    to: recipients,
    subject: subject,
    body: body
  });

  Logger.log('Weekly harvest email sent to: ' + recipients);
}
</pre>
        </div>
    </section>

    <!-- 6. Email Preview -->
    <section id="email-preview">
        <h2>6. ×ª×•×¦×¨ ×¡×•×¤×™: ×“×•×’××ª ××™×™×œ ×œ×× ×”×œ</h2>
        <p>×›×š ×™×›×•×œ ×œ×”×™×¨××•×ª ××™×™×œ ×”×¡×™×›×•× ×”×©×‘×•×¢×™ ×©××ª×§×‘×œ ××¦×œ ×¦×•×•×ª ×”× ×™×”×•×œ:</p>
        
        <div class="email-preview">
            <div class="email-header">
                <div class="email-meta"><strong>×××ª:</strong> Harvest System Alert</div>
                <div class="email-meta"><strong>××œ:</strong> ×¦×•×•×ª × ×™×”×•×œ ×”×§×˜×™×£</div>
                <div class="email-meta"><strong>× ×•×©×:</strong> ×¡×™×›×•× ×§×˜×™×£ ×©×‘×•×¢×™ â€“ 05/11/2025 ×¢×“ 12/11/2025</div>
            </div>
            <div class="email-body">
×¡×™×›×•× ×§×˜×™×£ ×©×‘×•×¢×™ â€“ 05/11/2025 ×¢×“ 12/11/2025

×¡×”"×› ×¤×˜×œ ×‘×›×œ ×”×—×××•×ª ×”×©×‘×•×¢: <strong>450.5 ×§"×’</strong>
(××ª×•×›× ×¡×•×’ ×‘': 32.0 ×§"×’, <span class="email-highlight">7%</span>)

-----------------------
<strong>×¤×™×¨×•×˜ ×¤×˜×œ ×œ×¤×™ ×—×××”:</strong>
×—×××” 1 (×××™×¨×”): 120.0 ×§"×’ ×¡×”"×›, 5.0 ×§"×’ ×¡×•×’ ×‘' (4%)
×—×××” 2 (×¡×§×™×™): 90.5 ×§"×’ ×¡×”"×›, 12.0 ×§"×’ ×¡×•×’ ×‘' (<span class="email-highlight">13%</span>)
×—×××” 3 (×§×œ×¨×™×˜×”): 140.0 ×§"×’ ×¡×”"×›, 8.0 ×§"×’ ×¡×•×’ ×‘' (6%)
...

<strong>×§×˜×™×£ × ×•×¡×£ ×”×©×‘×•×¢:</strong>
ğŸ“ ×ª×•×ª: 25.0 ×§"×’ (× ×¡×¤×§×™× + ×¡×•×’ ×‘')
ğŸ« ××•×¡× ×ª: 12.5 ×§"×’ (× ×¡×¤×§×™× + ×¡×•×’ ×‘')

×œ×¦×¤×™×™×” ×‘× ×ª×•× ×™× ×”××œ××™×:
[×§×™×©×•×¨ ×œ×—×•×‘×¨×ª ×”×¨××©×™×ª]
            </div>
        </div>
    </section>

    <!-- 7. Maintenance & Triggers -->
    <section id="maintenance">
        <h2>7. ×ª×—×–×•×§×” ×©×•×˜×¤×ª ×•×˜×¨×™×’×¨×™×</h2>

        <div class="callout info">
            <strong>× ×™×”×•×œ ×˜×¨×™×’×¨×™× (Triggers):</strong><br>
            ×‘××¢×¨×›×ª ××•×’×“×¨×™× ×©× ×™ ×˜×¨×™×’×¨×™× ××¨×›×–×™×™×:
            <ul>
                <li><strong>On change / On edit</strong> â€“ ××¤×¢×™×œ ××ª <code>rebuildHarvestData</code> ×›××©×¨ ×”× ×ª×•× ×™× ×‘-<code>Raw_Responses</code> ××ª×¢×“×›× ×™× (×œ××©×œ ×‘×¢×§×‘×•×ª <code>IMPORTRANGE</code>).</li>
                <li><strong>Time-driven ×©×‘×•×¢×™</strong> â€“ ××¤×¢×™×œ ××ª <code>sendWeeklyHarvestEmail</code> ×¤×¢× ×‘×©×‘×•×¢ (×œ××©×œ, ×™×•× ×—××™×©×™ ×‘×¢×¨×‘).</li>
            </ul>
        </div>

        <h3>××™×š ×œ×”×’×“×™×¨ / ×œ×¢×“×›×Ÿ ×˜×¨×™×’×¨ ×–××Ÿ ×©×‘×•×¢×™</h3>
        <ol>
            <li>× ×›× ×¡×™× ×œ×¤×¨×•×™×§×˜ Apps Script ×”××—×•×‘×¨ ×œ×—×•×‘×¨×ª ×”×¨××©×™×ª.</li>
            <li>×‘×¦×“ ×©×××œ ×‘×•×—×¨×™× "××¤×¢×™×œ×™×" (Triggers).</li>
            <li>×œ×•×—×¦×™× ×¢×œ "×”×•×¡×¤×ª ×˜×¨×™×’×¨ ×—×“×©".</li>
            <li>×‘×•×—×¨×™×:
                <ul>
                    <li>×¤×•× ×§×¦×™×” ×œ×”×¤×¢×œ×”: <code>sendWeeklyHarvestEmail</code>.</li>
                    <li>×¡×•×’ ×˜×¨×™×’×¨: Time-driven.</li>
                    <li>×ª×“×™×¨×•×ª: Weekly.</li>
                    <li>×™×•× ×•×©×¢×”: ×œ×“×•×’××” â€“ ×™×•× ×—××™×©×™, ×‘×™×Ÿ 20:00â€“21:00.</li>
                </ul>
            </li>
            <li>×××©×¨×™× ×”×¨×©××•×ª (×’×™×©×” ×œ×§×¨×™××” ××”×’×™×œ×™×•×Ÿ ×•×©×œ×™×—×ª ××™×™×œ×™×).</li>
        </ol>

        <h3>×©×›×¤×•×œ ×œ×¢×¡×§ × ×•×¡×£</h3>
        <ol>
            <li>×©×›×¤×•×œ ×’×™×œ×™×•×Ÿ ×”×ª×©×•×‘×•×ª ×•×©×›×¤×•×œ ×”×—×•×‘×¨×ª ×”×¨××©×™×ª.</li>
            <li>×™×¦×™×¨×ª ×˜×•×¤×¡ Fillout ×—×“×© ×•×—×™×‘×•×¨×• ×œ×’×™×œ×™×•×Ÿ ×”×ª×©×•×‘×•×ª ×”×—×“×©.</li>
            <li>×¢×“×›×•×Ÿ × ×•×¡×—×ª <code>IMPORTRANGE</code> ×‘×’×™×œ×™×•×Ÿ <code>Raw_Responses</code> ×‘×—×•×‘×¨×ª ×”×—×“×©×”.</li>
            <li>×¢×“×›×•×Ÿ ×›×ª×•×‘×•×ª ×”××™×™×œ ×‘-<code>sendWeeklyHarvestEmail</code>.</li>
            <li>×”×’×“×¨×ª ×˜×¨×™×’×¨×™× ×—×“×©×™× (On change + Weekly) ×‘×¤×¨×•×™×§×˜ Apps Script ×”×—×“×©.</li>
        </ol>

        <a href="#top" class="top-link">â†‘ ×—×–×¨×” ×œ××¢×œ×”</a>
    </section>

</div>

<footer>
    <p>Â© 2025 ×”×¤×˜×œ ×©×œ ×¢×•×¤×¨ | ××¢×¨×›×ª Harvest</p>
</footer>

<script>
    function copyToClipboard(elementId) {
        const text = document.getElementById(elementId).innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert('×”×§×•×“ ×”×•×¢×ª×§ ×œ×œ×•×—!');
        }, (err) => {
            console.error('×©×’×™××” ×‘×”×¢×ª×§×”: ', err);
        });
    }
</script>

</body>
</html>

Clean index.html â€“ remove duplicate HTML

